---
import type { SVGAttributes } from "../../types";
import { overrideSvgAttributes } from "./overrideSvgAttributes";

// accepts SVG attributes which will override the ones in the original SVG
export interface Props extends SVGAttributes {
  /**  pass an `import("*.svg?raw")` to `Svg` for the svg file to use */
  src: Promise<typeof import("*.svg?raw")>;
}

const { src, ...attributeOverrides } = Astro.props as Props;

const SVG_NOT_FOUND = "Could not find an SVG at the provided `src`";

const svgImport = await src;

if (!svgImport) {
  throw new Error(SVG_NOT_FOUND);
}

const svgSource = svgImport.default;

if (!svgSource) {
  throw new Error(SVG_NOT_FOUND);
}

if (!svgSource.trim().startsWith("<svg")) {
  throw new Error(`${SVG_NOT_FOUND}, provided: ${svgSource.slice(0, 23)}`);
}

const contents = overrideSvgAttributes(svgSource, attributeOverrides);
---

<Fragment set:html={contents} />
